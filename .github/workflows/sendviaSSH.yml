# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.
# This workflow will build a package using Gradle and then publish it to GitHub packages when a release is created
# For more information see: https://github.com/actions/setup-java/blob/main/docs/advanced-usage.md#Publishing-using-gradle

name: Send Crawled Files via SSH

on:
  schedule:
    - cron: '*/45 * * * *'  # 매 12시간마다 실행
jobs:
  build:
    runs-on: ubuntu-latest
    # env:
    #   SECRET_API_KEY: ${{ secrets.COMMAND }}
    permissions:
      contents: read
      packages: write
    steps:
        
    - name: SSH into Deployment Server
      uses: appleboy/ssh-action@master
      with:
        proxy_host: ${{ secrets.PROXY_SERVER_HOST }}
        proxy_port: ${{ secrets.PROXY_SERVER_PORT }}
        proxy_username: ${{ secrets.PROXY_SERVER_USERNAME }}
        proxy_key: ${{ secrets.SSH_KEY }}
        host: ${{ secrets.SERVER_HOST }}
        port: ${{ secrets.SERVER_PORT }}
        username: ${{ secrets.SERVER_USERNAME }}
        key: ${{ secrets.SSH_KEY }}
        envs: |
          PYSPARK_PYTHON=python3.6
        script: |
          bash ~/news/getNewsAndCopyToHDFS.sh
          sleep 5
          zsh ~/wordcount/wordcountToHBASE.sh > ~/wordcountToHBASE_log
          sleep 10
          python3.6 ~/wordcloud/generate_wordcloud.py
